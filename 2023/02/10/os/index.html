<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Max Wang"><meta name="keywords" content=""><meta name="description" content="[TOC] 概述基本概念 操作系统的定义：操作系统是控制、管理、分配、调度计算机硬件与软件资源与工作，为用户和其他软件提供接口与环境的程序集合。操作系统是最基本的系统软件。 操作系统的基本特征： 并发：并发是指两个或多个事件在同一时间间隔发生。在 操作系统的并发性是指计算机系统当中同时存在多个运行当中的程序，os具有处理和调试多个程序同时执行的能力。 引入进程的目的是为了使程序能够并发的执行。 注"><meta property="og:type" content="article"><meta property="og:title" content="操作系统笔记"><meta property="og:url" content="https://max-wzm.github.io/2023/02/10/os/index.html"><meta property="og:site_name" content="Max Wang&#39;s blog"><meta property="og:description" content="[TOC] 概述基本概念 操作系统的定义：操作系统是控制、管理、分配、调度计算机硬件与软件资源与工作，为用户和其他软件提供接口与环境的程序集合。操作系统是最基本的系统软件。 操作系统的基本特征： 并发：并发是指两个或多个事件在同一时间间隔发生。在 操作系统的并发性是指计算机系统当中同时存在多个运行当中的程序，os具有处理和调试多个程序同时执行的能力。 引入进程的目的是为了使程序能够并发的执行。 注"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://max-wzm.github.io/2023/02/10/os/syscall.png"><meta property="article:published_time" content="2023-02-10T15:39:09.000Z"><meta property="article:modified_time" content="2023-02-10T20:39:53.195Z"><meta property="article:author" content="Max Wang"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://max-wzm.github.io/2023/02/10/os/syscall.png"><title>操作系统笔记 - Max Wang&#39;s blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"max-wzm.github.io",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Max Wang&#39;s blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="操作系统笔记"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Max Wang </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-02-10 23:39" pubdate>2023年2月10日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 22 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">操作系统笔记</h1><div class="markdown-body"><p>[TOC]</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul><li>操作系统的定义：<br>操作系统是控制、管理、分配、调度计算机硬件与软件资源与工作，为用户和其他软件提供接口与环境的程序集合。操作系统是最基本的系统软件。</li><li>操作系统的基本特征：<ul><li>并发：<br>并发是指两个或多个事件在同一时间间隔发生。在<ul><li>操作系统的并发性是指计算机系统当中同时存在多个运行当中的程序，os具有处理和调试多个程序同时执行的能力。</li><li>引入进程的目的是为了使程序能够并发的执行。<blockquote><p>注意并发与并行的区别：</p><ul><li>并发：把一段时间切割成很多片，每一小片有且只有一个程序在占用。很多的程序占有时间片，分时交替执行。从宏观上看好像很多程序在在同时执行，但是从微观上看，一个时刻只有一个程序在执行。</li><li>并行：是真正的同时执行，在同一时刻能够进行多个程序的工作。</li><li>并发是通过操作系统分时实现的，是一种软件层面上的实现；而并行需要硬件的支持，如多处理器。</li></ul></blockquote></li></ul></li><li>共享：<br>共享是指系统当中的资源可以给多个 <strong>并发进行</strong> 的进程共同使用。分为两类：<ul><li>互斥共享：<br>只有在进程A访问并释放后，才允许另外一个进程B访问。即在 <strong>一段时间</strong> 内只允许一个进程访问。这种资源叫做 <strong>临界资源</strong>， 如打印机。</li><li>同时访问：<br>从宏观上看，在 <strong>一段时间</strong> 内可以允许有多个进程同时访问。不过从微观上看，不同进程还是轮流交替访问的。比如磁盘设备。<blockquote><p>并发和共享是os当中 <strong>最基本</strong> 的两个特征，两者互相依赖，互为存在条件。</p></blockquote></li></ul></li><li>虚拟：<br>虚拟是指把物理上的实体变成逻辑上的对应物，有以下应用：<ul><li>时分复用技术：<br>虚拟处理器：通过多道程序设计的技术，把一个物理CPU虚拟为多个逻辑上的CPU。</li><li>空分复用技术：<br>虚拟内存：将物理存储器转变为虚拟存储，可以逻辑上扩充存储器的容量。<blockquote><p>You may refer to <a target="_blank" rel="noopener" href="https://www.xiaolincoding.com/os/3_memory/alloc_mem.html">在 4GB 物理内存的机器上，申请 8G 内存会怎么样？</a></p></blockquote></li></ul></li><li>异步：<br>多个程序可以并发执行，但是由于资源有限（资源竞争），进行的执行以不可预知的速度向前推进，这就是进程的异步性。<br>异步性可能会导致程序产生一些与时间有关的错误，如data race。</li></ul></li><li>操作系统作为计算机系统资源管理者的功能：<ul><li>处理器管理（进程管理）</li><li>存储器管理（内存管理）</li><li>文件管理</li><li>IO设备管理</li></ul></li><li>操作系统为用户与计算机硬件之间提供接口：<ul><li>命令接口：<ul><li>联机命令接口：<br>用户说一句话，os做一件事，并反馈，强调交互性。</li><li>命令接口：<br>用户把os要做的写在清单上，os按照清单执行，用户不能直接干预。</li></ul></li><li>程序接口：<br>程序接口由系统调用（aka广义指令）组成。用户程序可以通过os来使用外设、申请分配和回收内存等等。包括图形用户界面（GUI）也是通过程序接口实现的。</li></ul></li></ul><h3 id="OS的发展与分类"><a href="#OS的发展与分类" class="headerlink" title="OS的发展与分类"></a>OS的发展与分类</h3><ol><li>手工操作阶段（无OS）：<ul><li>由用户完成程序的装入、运行、结果输出等</li></ul></li><li>批处理阶段（OS出现）：<br>批处理系统是实现作业自动控制而无须人工干预的系统。<ul><li>单道批处理系统：<br>系统对作业（程序）的处理是成批进行的，但是在内存当中始终只有一道作业。<br>主要特征有：<ul><li>自动性：<br>磁带上的一批作业（程序）能够自动逐个运行，无须人工干预。</li><li>顺序性：<br>磁带上的各个作业按顺序进入内存，作业按照队列执行。</li><li>单道性：<br>内存当中只有一道程序在运行。</li></ul></li><li>多道批处理系统：<br>允许多个程序同时进入内存并允许他们在CPU当中交替运行，实现对硬件软件资源的共享。<br>主要特征有：<ul><li>多道</li><li>宏观上并行</li><li>微观上串行</li></ul></li></ul></li><li>分时操作系统<br>多道批处理系统无法提供人工干预，而分时os使用时间片轮转，实现了人机交互。<br>主要特征有：<ul><li>同时性（多路性）：<br>允许多个终端用户同时使用一台计算机。</li><li>交互性</li><li>独立性：<br>各个用户独立操作，互不干扰</li><li>及时性：<br>用户请求能在很短时间内得到响应。</li></ul></li><li>实时操作系统：<br>相比于分时系统，实时操作系统可以在接受外部信号之后及时处理。引入了 <strong>优先级和可抢占</strong>。</li><li>网络os和分布式os</li><li>个人os：如Windows, Mac OS, Linux, Android, etc.</li></ol><h3 id="OS运行环境"><a href="#OS运行环境" class="headerlink" title="OS运行环境"></a>OS运行环境</h3><h4 id="内核态与用户态"><a href="#内核态与用户态" class="headerlink" title="内核态与用户态"></a>内核态与用户态</h4><p>在计算机系统当中，通常CPU可以执行两种不同性质的程序：</p><ul><li>OS<strong>内核程序</strong></li><li>用户自编程序（<strong>应用程序</strong>）<br>前者是后者的管理者</li></ul><p>内核程序可以执行一些特权指令，而应用程序不行。如IO指令、中断指令、内存保护相关指令等。</p><p>基于以上，将CPU的状态划分为 <strong>用户态</strong> 和 <strong>内核态</strong> 。</p><p>OS的内核构成：</p><ul><li>与硬件相关的模块：如 <strong>时钟管理、中断处理、设备驱动</strong>。<ul><li>时钟管理：<ul><li>计时</li><li>时钟中断，实现进程的切换（如时间片轮转调度）</li></ul></li><li>中断处理：<br>如键鼠输入、进程管理、系统调用、设备驱动、文件访问。<br>中断机制当中只有一小部分属于内核，它们负责保护和恢复中断现场的信息，然后转移到相关的处理程序。</li><li>原语：逆天的名字，aka Atomic Operation <strong>原子性操作</strong><br>底层的一些可以被调用的公用小程序<ul><li>处于OS的最底层，是最接近硬件的部分。</li><li>具有原子性，不可被中断。<blockquote><p>定义原语可以直接关闭中断，完成后再打开中断。<br>系统当中的设备驱动、CPU切换、进程通信当中的一些操作都可以定义成原语，成为内核的一部分。</p></blockquote></li></ul></li></ul></li><li>与运行有关的程序，如 <strong>进程管理、内存管理、设备管理</strong>。<ul><li>系统控制的数据结构与处理：<br>如PCB，TCB，消息队列、内存分配表等等。对其的定义与操作，也是在内核态中完成的。<br>常见的功能有：<ul><li>进程管理</li><li>存储器管理</li><li>设备管理</li></ul></li></ul></li></ul><blockquote><p>内核态指令实际上包括了系统调用类指令和一些针对时钟、中断和原语的操作指令。</p></blockquote><h4 id="中断与异常"><a href="#中断与异常" class="headerlink" title="中断与异常"></a>中断与异常</h4><p>也可以叫做中断（外中断）与异常（内中断）。</p><ul><li>系统不允许用户程序实现内核态的功能，但是有时候他们又必须使用，就得通过中断或者异常实现。</li><li>中断，是指来自 <strong>CPU执行指令以外</strong> 的事件的发生，如外设请求和人为干预。</li><li>异常，除了内中断，也叫陷入（trap），来自 <strong>CPU执行指令以内</strong> 的事件，如地址越界、算术溢出、缺页中断、专门的陷入指令等等。异常不能被屏蔽，一旦出现要立刻处理。</li></ul><p>中断处理的过程：参考计组。</p><ul><li>需要注意的是，关中断、保存断点、中断服务程序寻址是通过硬件自动完成的。</li></ul><h4 id="状态的转换"><a href="#状态的转换" class="headerlink" title="状态的转换"></a>状态的转换</h4><p>用户态与内核态的转换可能发生在以下的情况：</p><ul><li>用户要求os服务，即系统调用</li><li>发生了一次中断</li><li>用户产生的错误状态</li><li>用户程序企图执行特权指令</li></ul><blockquote><ul><li>trap指令（aka 访管指令）是由用户态执行的，用以陷入内核态，因此trap指令不是特权指令。</li><li>从内核态转换回用户态，如中断返回指令，是特权指令。<br>从用户态进入内核态，除了CPU状态之外，所使用的堆栈也需要从用户堆栈转移到内核堆栈。</li></ul></blockquote><img src="/2023/02/10/os/syscall.png" srcset="/img/loading.gif" lazyload title="syscall"><p>一个经典的系统调用执行过程，如上图所示。：</p><ol><li>用户进程传递syscall的参数</li><li>在用户态执行trap指令，将用户态转换为内核态</li><li>CPU执行内核态服务程序</li><li>返回用户态</li></ol><h2 id="进程与线程"><a href="#进程与线程" class="headerlink" title="进程与线程"></a>进程与线程</h2><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><h2 id="I-x2F-O与存储"><a href="#I-x2F-O与存储" class="headerlink" title="I&#x2F;O与存储"></a>I&#x2F;O与存储</h2><h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="category-chain-item">操作系统</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>操作系统笔记</div><div>https://max-wzm.github.io/2023/02/10/os/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Max Wang</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年2月10日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/2023/02/04/raft/" title="Raft算法的原理与实现"><span class="hidden-mobile">Raft算法的原理与实现</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script>if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });</script><script src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>